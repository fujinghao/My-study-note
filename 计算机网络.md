## 1. 键入网址到网页显示,期间发生了什么
### 1.解析URL
首先会对 URL 进行解析，从而生成发送给 Web 服务器的 HTTP 请求信息。
### 2.查找缓存
在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件。当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。
### 3.DNS解析
- 浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回，如果没有，就去问操作系统，操作系统也会去看自己的缓存，如果有，就直接返回，如果没有，再去 hosts 文件看，也没有，才会去问**本地 DNS 服务器**。
- **本地DNS服务器**收到客户端的请求后，如果缓存里的表格能找到 www.server.com IP 地址, 则它直接返回 IP 地址。如果没有，**本地DNS服务器** 会去问它的**根域名服务器**：“老大， 能告诉我 www.server.com 的 IP 地址吗？” 根域名服务器是最高层次的，它不直接用于域名解析，但能指明一条道路。
- **根 DNS** 收到来自**本地 DNS** 的请求后，发现后置是 .com，说：“www.server.com 这个域名归 .com 区域管理”，我给你 .com **顶级域名服务器**地址，你去问问它吧。
- 本地 DNS 收到**顶级域名服务器**的地址后，发起请求询问 **顶级域名服务器** www.server.com 的 IP 地址。**顶级域名服务器**说：“我给你负责 www.server.com 区域的**权威 DNS 服务器**的地址，你去问它应该能问到”。
- 本地 DNS 于是转向问**权威 DNS 服务器**：“www.server.com对应的IP是啥呀？” server.com 的权威 DNS 服务器，它是域名解析结果的原出处。
- **权威 DNS 服务器**查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。
- **本地 DNS** 再将 IP 地址返回客户端。
### 4.获取MAC地址
当浏览器得到 IP 地址后，数据传输还需要知道目的主机 MAC 地址，因为应用层下发数据给传输层，TCP 协议会指定源端口号和目的端口号，然后下发给网络层。网络层会将本机地址作为源地址，获取的 IP 地址作为目的地址。然后将下发给数据链路层，数据链路层的发送需要加入通信双方的 MAC 地址，本机的 MAC 地址作为源 MAC 地址，目的 MAC 地址需要分情况处理。通过将 IP 地址与本机的子网掩码相与，可以判断是否与请求主机在同一个子网里。
如果在同一个子网里，可以使用 APR 协议获取到目的主机的 MAC 地址。
如果不在一个子网里，那么请求应该转发给网关，由它代为转发，此时同样可以通过 ARP 协议来获取网关的 MAC 地址，值得注意的是，此时目的主机的 MAC 地址应该为网关的地址。
### 5.建立TCP连接
- 既然IP地址和端口准备好了，那么下一步是不是可以建立TCP连接了呢？
答案是“不一定可以”。Chrome有个机制，**同一个域名同时最多只能建立6个TCP连接**，如果在同一个域名下同时有10个请求发生，那么其中4个请求会进入**排队等待状态**，直至进行中的请求完成。当然，如果当前请求数量少于6，会直接进入下一步，建立TCP连接。
- 排队等待结束之后，终于可以快乐地和服务器握手了，在HTTP工作开始之前，浏览器通过TCP与服务器建立三次握手。
### 6.发送HTTP请求
一旦建立了TCP连接，浏览器就可以和服务器进行通信了。而HTTP中的数据正是在这个通信过程中传输的。
<div align=center><img src="C:\Users\13683\vscodeProjrct\cpp\cpp笔记\fig\http请求报文.jpg"height="465"/> </div>

首先浏览器会向服务器发送请求行，它包括了**请求方法**、**请求URI**和**HTTP版本协议**。发送请求行，就是告诉服务器浏览器需要什么资源.

- 最常用的请求方法是Get。
- 另外一个常用的请求方法是POST，它用于发送一些数据给服务器，比如登录一个网站，就需要通过POST方法把用户信息发送给服务器。如果使用POST方法，那么浏览器还要准备数据给服务器，这里准备的数据是通过请求体来发送。

### 7.服务器端处理HTTP请求流程

当服务器收到我们的请求之后，他会生成一个响应，以响应报文的形式返回客户端。**不同的是**，在响应报文的开始行不再是请求行，而是状态行。

<div align=center><img src="C:\Users\13683\vscodeProjrct\cpp\cpp笔记\fig\http响应报文.jpg"height="465"/> </div>

### 8.浏览器渲染页面并展现

当客户端拿到响应文本经过层层解析，最终浏览器拿到HTML响应报文后，便开始渲染页面
### 9.断开连接(TCP四次挥手)
通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。不过如果浏览器或者服务器在其头信息中加入了：
>Connection:Keep-Alive

那么TCP连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个TCP连接发送请求。保持TCP连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。比如，一个Web页面中内嵌的图片就都来自同一个Web站点，如果初始化了一个持久连接，你就可以复用该连接，以请求其他资源，而不需要重新再建立新的TCP连接。

## 2. 键入网址到网页显示,期间发生了什么