## 1. 索引

## 2. 事务
## 3. 锁
## 4. 日志

## 5. Buffer Pool
### 5.1 为什么要有Buffer Pool
因为MySQL 的数据是存储在磁盘里的，如果每次都从磁盘里面读取数据，这样性能是极差的。
为此，InnoDB 存储引擎设计了Buffer Pool作为缓冲池，来提高数据库的读写性能。

有了缓冲池后：
- 当读取数据时，如果数据存在于 Buffer Pool 中，客户端就会直接读取 Buffer Pool 中的数据，否则再去磁盘中读取。
- 当修改数据时，首先是修改 Buffer Pool 中数据所在的页，然后将其页设置为脏页，最后由后台线程将脏页写入到磁盘。

InnoDB 会把存储的数据划分为若干个「页」，以页作为磁盘和内存交互的基本单位，一个页的默认大小为 16KB。因此，Buffer Pool 同样需要按「页」来划分。
为了更好的管理这些在 Buffer Pool 中的缓存页，InnoDB 为每一个缓存页都创建了一个控制块，控制块信息包括「缓存页的表空间、页号、缓存页地址、链表节点」等等。
<div align=center><img src=".\fig\buffer_pool.jpg"height="465"/> </div>

当我们划分好所有的控制块与数据页后，可能会有剩余的空间不够一对控制块和缓存页的大小，这部分就是多余的碎片空间。



### 5.2 如何管理 Buffer Pool？

#### 5.2.1  如何管理空闲页？

Buffer Pool 中的缓存页既有空闲的，也有被使用的。那当我们从磁盘读取数据的时,通过遍历这一片连续的内存空间来找到空闲的缓存页效率太低了。所以，为了能够快速找到空闲的缓存页，可以使用链表结构，将空闲缓存页的「控制块」作为链表的节点，这个链表称为 **Free 链表**（空闲链表）。

<div align=center><img src=".\fig\freelist.webp"height="465"/> </div>

Free 链表上除了有控制块，还有一个头节点，该头节点包含链表的头节点地址，尾节点地址，以及当前链表中节点的数量等信息。有了 Free 链表后，每当需要从磁盘中加载一个页到 Buffer Pool 中时，就从 Free链表中取一个空闲的缓存页，然后把该缓存页对应的控制块从 Free 链表中移除。

#### 5.2.2 如何管理脏页？

更新数据的时候，不需要每次都要写入磁盘，而是将 Buffer Pool 对应的缓存页标记为**脏页**，然后再由后台线程将脏页写入到磁盘。为了能快速知道哪些缓存页是脏的，于是就设计出 **Flush 链表**，它跟 Free 链表类似的，链表的节点也是控制块，区别在于 Flush 链表的元素都是脏页。

<div align=center><img src=".\fig\flushlist.webp"height="465"/> </div>

当控制块被加入到Flush 链表后，后台线程就可以遍历 Flush 链表，将脏页写入到磁盘
